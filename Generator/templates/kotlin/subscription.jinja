/**
 * {{ description }}
 *
 * Endpoint: {{ endpoint }}
 */
fun ATProtoClient.{{ namespace_path }}.{{ function_name }}(
    {% if has_parameters %}parameters: {{ parameters_type }}{% endif %}
): Flow<{{ message_type }}> = flow {
    val endpoint = "{{ endpoint }}"

    {% if has_parameters %}
    val queryParams = parameters.toQueryParams()
    {% else %}
    val queryParams: Map<String, String>? = null
    {% endif %}

    // TODO: Implement WebSocket connection using a WebSocket library (e.g., Ktor WebSockets)
    // The implementation should:
    // 1. Establish WebSocket connection to endpoint with queryParams
    // 2. Listen for incoming messages
    // 3. Deserialize each message as {{ message_type }}
    // 4. Emit each message to the Flow
    // Example skeleton:
    // webSocketClient.connect(endpoint, queryParams) { message ->
    //     val decoded = Json.decodeFromString<{{ message_type }}>(message)
    //     emit(decoded)
    // }
    throw NotImplementedError("WebSocket subscription support requires a WebSocket client implementation")
}
